<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Summer of Code Contributions • styler</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">styler</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/customizing_styler.html">Customizing styler</a>
    </li>
    <li>
      <a href="../articles/gsoc_contrib.html">Google Summer of Code Contributions</a>
    </li>
    <li>
      <a href="../articles/gsoc_proposal/data_structures.html">Data Structures</a>
    </li>
    <li>
      <a href="../articles/gsoc_proposal/manipulating_nested_parse_data.html">Manipulating the nested parse table</a>
    </li>
    <li>
      <a href="../articles/performance_improvements.html">Performance Improvements</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/krlmlr/styler">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Google Summer of Code Contributions</h1>
                        <h4 class="author">Lorenz Walthert</h4>
            
            <h4 class="date">2017-08-25</h4>
          </div>

    
    
<div class="contents">
<p>This vignette aims to summarize the contributions made to styler through Google Summer of Code 2017.</p>
<div id="styler-in-practice" class="section level1">
<h1 class="hasAnchor">
<a href="#styler-in-practice" class="anchor"></a>Styler in practice</h1>
<p>As a warm-up, we want to give a few examples of how styler styles code. It’s possible to use different levels of invasiveness, as described in the help file for the style guide we implemented, which is the <a href="http://style.tidyverse.org/index.html">tidyverse style guide</a>. For example, we can limit ourselves to styling just spacing information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"styler"</span>)
<span class="kw">library</span>(<span class="st">"magrittr"</span>)
<span class="kw"><a href="../reference/style_text.html">style_text</a></span>(<span class="st">"a=3; 2"</span>, <span class="dt">scope =</span> <span class="st">"spaces"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">cat</span>()</code></pre></div>
<pre><code>a = 3; 2</code></pre>
<p>Or, on the other extreme of the scale, styling spaces, indention, line breaks and tokens:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/style_text.html">style_text</a></span>(<span class="st">"a=3; 2"</span>, <span class="dt">scope =</span> <span class="st">"tokens"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cat</span>(<span class="dt">sep =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>a &lt;- 3
2</code></pre>
<p>Another option that is helpful to determine the level of invasiveness is <code>strict</code>. If set to <code>TRUE</code>, spaces and line breaks after or before tokens are set to either zero or one. However, in some situations that might be undesirable, as the following example shows</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/style_text.html">style_text</a></span>(
  <span class="st">"data_frame(</span>
<span class="st">     small  = 2 ,</span>
<span class="st">     medium = 4,#comment without space</span>
<span class="st">     large  = 6</span>
<span class="st">   )"</span>, <span class="dt">strict =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cat</span>(<span class="dt">sep =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>data_frame(
  small  = 2,
  medium = 4, # comment without space
  large  = 6
)</code></pre>
<p>I hope these examples showed you some of the options available in styler. Let us for now focus on a configuration with <code>strict = TRUE</code> and <code>scope = "tokens"</code> and therefore only show code before and after styling.</p>
<p>styler can distinguish unary operators and other math tokens:</p>
<pre class="styler"><code># Before
1++1-1-1/2</code></pre>
<pre><code># After
1 + +1 - 1 - 1 / 2</code></pre>
<p>It can also format complicated expressions that involve line breaking and indention based on both brace expressions and operators:</p>
<pre class="styler"><code># Before
if (x &gt;3) {stop("this is an error")} else {
c(there_are_fairly_long,
1 / 33 * 
2 * long_long_variable_names)%&gt;% k(

) }</code></pre>
<pre><code># After
if (x &gt; 3) {
  stop("this is an error")
} else {
  c(
    there_are_fairly_long,
    1 / 33 *
      2 * long_long_variable_names
  ) %&gt;%
    k()
}</code></pre>
<p>Lines are broken after <code>(</code> if a function calls spans over multiple lines</p>
<pre class="styler"><code># Before
do_a_long_and_complicated_fun_cal("which", has, way, to, 
                              "and longer then lorem ipsum in its full length"
                              )</code></pre>
<pre><code># After
do_a_long_and_complicated_fun_cal(
  "which", has, way, to,
  "and longer then lorem ipsum in its full length"
)</code></pre>
<p>Styler converges <code>=</code> assignment, Single quotes if necessary, adds braces to function calls in pipes</p>
<pre class="styler"><code># Before
one= 'one string'
two= "one string in a 'string'"
a %&gt;%
  b %&gt;%
  c
</code></pre>
<pre><code># After
one &lt;- "one string"
two &lt;- "one string in a 'string'"
a %&gt;%
  b() %&gt;%
  c()</code></pre>
<p>Function declarations are indented if multi-line</p>
<pre class="styler"><code># Before
my_fun &lt;- function(x, 
y, 
z) {
  just(z)
}</code></pre>
<pre><code># After
my_fun &lt;- function(x,
                   y,
                   z) {
  just(z)
}</code></pre>
<p>Styler can also deal with tidyeval syntax</p>
<pre class="styler"><code># Before
mtcars %&gt;%
  group_by(! !! my_vars)</code></pre>
<pre><code># After
mtcars %&gt;%
  group_by(!!! my_vars)</code></pre>
</div>
<div id="contributions-to-styler-during-gsoc" class="section level1">
<h1 class="hasAnchor">
<a href="#contributions-to-styler-during-gsoc" class="anchor"></a>Contributions to styler during GSOC</h1>
<p>The author, with the help of his mentors,</p>
<ul>
<li>opened over <a href="https://github.com/krlmlr/styler/issues?utf8=%E2%9C%93&amp;q=is%3Aopen%20is%3Aissue%20author%3Alorenzwalthert%20created%3A%3C2017-08-31%20%20created%3A%3E2017-06-01%20">60</a> issues and closed the majority of them with his own pull requests.</li>
<li>created more than <a href="https://github.com/krlmlr/styler/pulls?q=is%3Apr+author%3Alorenzwalthert+created%3A%3C2017-08-31++created%3A%3E2017-06-01">60</a> pull requests to master of which the vast majority was merged.</li>
</ul>
<p>The activity during GSOC can be grouped as follows:</p>
<ul>
<li>
<em>Replicating the outcomes that were achieved with flat styling with nested styling.</em> Required implementation of the visitor as well as different serialization method.</li>
<li>
<em>Adding functionality that was only possible with the nested styling</em> such as indention based on operators (<code>+</code>, <code>%&gt;%</code> etc.), braces <code>{</code> and <code>(</code>. the use of raw indention, allowing for token-dependent re-indention.</li>
<li>
<em>Infrastructure changes</em> such as serialized testing, improve performance, create multi-line attribute, code re-factoring. Partially flattening out the nested parse table.</li>
<li>
<em>Extending the functionality that was not there with the flat approach.</em> Examples include styling multiple expressions, token replacement (e.g. <code>&lt;-</code> for <code>=</code>), line break rules (invasive and non-invasive), token insertion (<code>()</code> in function calls within pipes), RStudio Addins, styling of comments, styling of a single file, public API redesign, spacing around more operators (colons, commas, infix operators, bang-bang).</li>
</ul>
<p>The list above is not comprehensive and covers only the large contributions. Always along with coding, documentation and tests were provided. With regard to the initial <a href="https://docs.google.com/document/d/1V7ZWOVjEqM6-vc7WVxePUOHHc48HJwBKh8gAwIFALJ4/edit">proposal</a>, we can say that steps one to four (increase documentation and testing of code, perform all operations on with a nested structure, and fully support the tidyverse style guide) were completed to a large extend and a few points under step five have been implemented too. The remaining points under step five as well as the open issues of the repository indicate the direction of further development of the package.</p>
<p>The tidyverse style guide does not cover all formatting cases, so in particular for function calls, there are various cases uncovered and a corresponding <a href="https://github.com/krlmlr/styler/issues/125">issue</a> was opened in the styler repository.</p>
<p>Also, it was not possible in this project to implement the rule that forces lines to be less than 80 characters long. We leave this to <a href="https://github.com/jimhester/lintr">lintr</a>. Known remaining problems are well-documented on the [issue page](<a href="https://github.com/krlmlr/styler/issues">issue</a> of the main repository on GitHub.</p>
<p>It is nice to see that <code>styler</code> already got some traction from the community. The maintainer of the package <a href="https://github.com/tidyverse/reprex">reprex</a> plans to <a href="https://github.com/tidyverse/reprex/issues/94">add styler as a dependency</a>. As soon as one of its dependencies is accepted to CRAN, styler will also be submitted.</p>
</div>
<div id="low-level-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#low-level-analysis" class="anchor"></a>Low-level analysis</h1>
<p>We can use the package <code>gitsum</code> to perform an analysis of the git repository.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"gitsum"</span>) <span class="co"># remotes::install_github("lorenzwalthert/gitsum")</span>
<span class="kw">library</span>(<span class="st">"tidyverse"</span>)
log &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gitsum/topics/git_log_detailed">git_log_detailed</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(date <span class="op">&gt;</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"2017-06-01"</span>), date <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"2017-08-31"</span>))</code></pre></div>
<p>We can see that the vast majority of the commits in this period comes from the student and a few from the main mentor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(author_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>()</code></pre></div>
<pre><code># A tibble: 2 x 2
# Groups:   author_name [2]
      author_name     n
            &lt;chr&gt; &lt;int&gt;
1   Kirill Müller    60
2 Lorenz Walthert   360</code></pre>
<p>We can also look at how the number of lines in the different files evolved:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lines &lt;-<span class="st"> </span>log <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/gitsum/topics/add_line_history">add_line_history</a></span>()

r_files &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">"^R/"</span>, lines<span class="op">$</span>changed_file, <span class="dt">value =</span> <span class="ot">TRUE</span>)

to_plot &lt;-<span class="st"> </span>lines <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(changed_file <span class="op">%in%</span><span class="st"> </span>r_files) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(changed_file) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">has_changed =</span> <span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(has_changed)
  
<span class="kw">ggplot</span>(to_plot, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> current_lines)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_step</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">"Number of Lines"</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>changed_file, <span class="dt">scales =</span> <span class="st">"free_y"</span>)</code></pre></div>
<p><img src="gsoc_contrib_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>The total number of insertions and deletions by the author is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(author_name <span class="op">==</span><span class="st"> "Lorenz Walthert"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw">sum</span>(total_insertions) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(total_deletions)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>()</code></pre></div>
<pre><code>[1] 26541</code></pre>
<p>Which still contains many insertions and deletions in some files that were generated as a bi-product, so let’s focus on the code in the <code>R</code> directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">dirname</span>(changed_file) <span class="op">==</span><span class="st"> "R"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw">sum</span>(insertions) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(deletions)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>()</code></pre></div>
<pre><code>[1] 5711</code></pre>
<p>The core code with .R file only consists of</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">.R$"</span>, <span class="kw">basename</span>(changed_file))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw">sum</span>(insertions) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(deletions)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cat</span>(<span class="st">"lines"</span>)</code></pre></div>
<pre><code>3972 lines</code></pre>
</div>
<div id="final-remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#final-remarks" class="anchor"></a>Final remarks</h1>
<p>First and foremost, I want to thank my mentors, in particular Kirill Mueller, for his patience and time he put into that project. I really appreciate that and I think apart from the code submitted, I benefited so much from him in terms of how to code, what considerations to make and how to deal with pitfalls and unexpected problems along the way.</p>
<p>In addition, I want to thank Google for their contributions to open source that made this project possible as well as all people involved with organizing GSOC from the R community. It was an amazing experience.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#styler-in-practice">Styler in practice</a></li>
      <li><a href="#contributions-to-styler-during-gsoc">Contributions to styler during GSOC</a></li>
      <li><a href="#low-level-analysis">Low-level analysis</a></li>
      <li><a href="#final-remarks">Final remarks</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kirill Müller, Lorenz Walthert.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
